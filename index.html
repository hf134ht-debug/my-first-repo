<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      /* 背景画像 */
      body::before {
        content: "";
        position: fixed;
        top:0; left:0;
        width:100%; height:100%;
        background-image: url('https://takatanouen.com/wp-content/uploads/2021/11/6f139b5aff6b0b56ebea56609d4ca516.png');
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0.25;
        z-index: -1;
      }

      body {
        font-family: 'Comic Sans MS','Arial',sans-serif;
        padding: 20px;
        max-width: 500px;
        margin: auto;
        font-size: 1.8em;
        min-height:100vh;
        background: linear-gradient(to bottom right, #e6f7d6, #f9ffd6);
        background-attachment: fixed;
      }

      h2 {
        text-align:center;
        font-size:2.5em;
        color:#3b7d32;
        text-shadow:2px 2px 5px rgba(255,255,255,0.8);
        animation: floatUp 4s ease-in-out infinite alternate;
      }

      @keyframes floatUp {0%{transform:translateY(0);}100%{transform:translateY(-12px);}}

      label {display:block; margin-top:12px; font-weight:bold; font-size:1.3em;}
      input, select, button {
        width:100%; padding:10px; margin-top:5px;
        box-sizing:border-box; font-size:1.2em; border-radius:8px; border:1px solid #aaa;
      }
      button {
        margin-top:15px; background-color:#a6d854; color:#fff; font-weight:bold; border:none; cursor:pointer;
      }
      button:hover {background-color:#8bc34a;}

      .store-row {
        display:flex; flex-wrap:wrap; gap:5px; margin-top:5px; align-items:center;
      }
      .store-row select, .store-row input {flex:1; min-width:120px;}
      @media (min-width:700px){.store-row select,.store-row input{flex:1;}}

      /* 品目ボタン */
      #itemContainer {
        display:flex; flex-wrap:wrap; gap:10px; margin-top:5px;
      }
      .item-button {
        flex:1 1 45%; padding:10px; font-size:1.2em; border:2px solid #3b7d32;
        border-radius:8px; cursor:pointer; text-align:center; user-select:none;
        transition: background 0.3s;
      }
      /* 初期色 */
      .item-白菜, .item-白菜カット { background-color:#d4f1a0; } /* 黄緑 */
      .item-キャベツ, .item-キャベツカット { background-color:#7ec850; } /* 緑 */
      .item-トウモロコシ { background: linear-gradient(to bottom, #fff86d, #ffffff); } /* 黄色→白 */

      /* 選択時 */
      .item-button.selected {
        background-color:#3b7d32 !important;
        color:white;
        font-weight:bold;
      }
    </style>
  </head>
  <body>
    <h2>出荷管理</h2>
    <form id="shipmentForm">
      <label>日付</label>
      <input type="date" name="date" required id="dateInput">

      <label>品目</label>
      <div id="itemContainer">
        <div class="item-button item-白菜" data-value="白菜">白菜</div>
        <div class="item-button item-白菜カット" data-value="白菜カット">白菜カット</div>
        <div class="item-button item-キャベツ" data-value="キャベツ">キャベツ</div>
        <div class="item-button item-キャベツカット" data-value="キャベツカット">キャベツカット</div>
        <div class="item-button item-トウモロコシ" data-value="トウモロコシ">トウモロコシ</div>
      </div>

      <label>値段</label>
      <input type="number" name="price" min="0" required>

      <div id="storesContainer">
        <label>店舗・個数</label>
        <div class="store-row">
          <select name="store">
            <option value="連島">連島</option>
            <option value="津高">津高</option>
            <option value="茶屋町">茶屋町</option>
            <option value="大安寺">大安寺</option>
            <option value="中庄">中庄</option>
            <option value="総社南">総社南</option>
            <option value="円山">円山</option>
            <option value="児島">児島</option>
          </select>
          <input type="number" name="quantity" min="1" placeholder="個数" required>
        </div>
      </div>

      <button type="button" onclick="addStore()">+ 店舗追加</button>
      <button type="submit">登録</button>
    </form>

    <script>
      const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzK497D-jhTqBKZs07bpcU1-DC4y5jmZIpYhFlfK9MXuvOrhz2jGuGppSNqxSNvwsWdNg/exec";

      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const dd = String(today.getDate()).padStart(2,'0');
      document.getElementById('dateInput').value = `${yyyy}-${mm}-${dd}`;

      const itemButtons = document.querySelectorAll('.item-button');
      let selectedItem = null;
      itemButtons.forEach(btn=>{
        btn.addEventListener('click', function(){
          itemButtons.forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          selectedItem = this.getAttribute('data-value');
        });
      });

      function addStore(){
        const container = document.getElementById('storesContainer');
        const div = document.createElement('div');
        div.className='store-row';
        div.innerHTML=`
          <select name="store">
            <option value="連島">連島</option>
            <option value="津高">津高</option>
            <option value="茶屋町">茶屋町</option>
            <option value="大安寺">大安寺</option>
            <option value="中庄">中庄</option>
            <option value="総社南">総社南</option>
            <option value="円山">円山</option>
            <option value="児島">児島</option>
          </select>
          <input type="number" name="quantity" min="1" placeholder="個数" required>
        `;
        container.appendChild(div);
      }

      document.getElementById('shipmentForm').addEventListener('submit', async function(e){
        e.preventDefault();
        if(!selectedItem){ alert('品目を選択してください'); return; }

        const form = e.target;
        const data = {
          date: form.date.value,
          item: selectedItem,
          price: form.price.value,
          stores: Array.from(form.querySelectorAll('.store-row')).map(row=>({
            name: row.querySelector('select[name="store"]').value,
            quantity: row.querySelector('input[name="quantity"]').value
          }))
        };

        try{
          await fetch(SCRIPT_URL,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify(data),
            mode:'no-cors'
          });
          alert('登録完了！');
          form.reset();
          document.getElementById('storesContainer').innerHTML=`
            <label>店舗・個数</label>
            <div class="store-row">
              <select name="store">
                <option value="連島">連島</option>
                <option value="津高">津高</option>
                <option value="茶屋町">茶屋町</option>
                <option value="大安寺">大安寺</option>
                <option value="中庄">中庄</option>
                <option value="総社南">総社南</option>
                <option value="円山">円山</option>
                <option value="児島">児島</option>
              </select>
              <input type="number" name="quantity" min="1" placeholder="個数" required>
            </div>
          `;
          itemButtons.forEach(b=>b.classList.remove('selected'));
          selectedItem = null;
          document.getElementById('dateInput').value=`${yyyy}-${mm}-${dd}`;
        }catch(err){
          alert('通信エラー: '+err);
        }
      });
    </script>
  </body>
</html>
