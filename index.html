<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‡ºè·ç®¡ç†PWA</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; max-width:500px; margin:auto; background:#f9ffd6; }
h2 { text-align:center; color:#3b7d32; }
label { display:block; margin-top:10px; font-weight:bold; }
input, select, button { width:100%; padding:8px; margin-top:5px; font-size:1em; border-radius:6px; border:1px solid #aaa; }
button { background-color:#a6d854; color:#fff; font-weight:bold; border:none; cursor:pointer; }
button:hover { background-color:#8bc34a; }
.store-row { display:flex; gap:5px; margin-top:5px; align-items:center; }
.store-row select, .store-row input { flex:1; }
#itemContainer { display:flex; flex-wrap:wrap; gap:10px; margin-top:5px; }
.item-button { flex:1 1 45%; padding:10px; background:#e0f0b8; border:2px solid #3b7d32; border-radius:8px; cursor:pointer; text-align:center; user-select:none; }
.item-button.selected { background-color:#3b7d32; color:white; font-weight:bold; }
</style>
</head>
<body>

<h2>å‡ºè·ç®¡ç†</h2>

<form id="shipmentForm">
  <label>æ—¥ä»˜</label>
  <input type="date" name="date" id="dateInput" required>

  <label>å“ç›®</label>
  <div id="itemContainer">
    <div class="item-button" data-value="ç™½èœ">ç™½èœ</div>
    <div class="item-button" data-value="ç™½èœã‚«ãƒƒãƒˆ">ç™½èœã‚«ãƒƒãƒˆ</div>
    <div class="item-button" data-value="ã‚­ãƒ£ãƒ™ãƒ„">ã‚­ãƒ£ãƒ™ãƒ„</div>
    <div class="item-button" data-value="ã‚­ãƒ£ãƒ™ãƒ„ã‚«ãƒƒãƒˆ">ã‚­ãƒ£ãƒ™ãƒ„ã‚«ãƒƒãƒˆ</div>
    <div class="item-button" data-value="ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·">ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·</div>
  </div>

  <label>å€¤æ®µ</label>
  <input type="number" name="price" min="0" required>

  <div id="storesContainer">
    <label>åº—èˆ—ãƒ»å€‹æ•°</label>
    <div class="store-row">
      <select name="store">
        <option value="é€£å³¶">é€£å³¶</option>
        <option value="æ´¥é«˜">æ´¥é«˜</option>
        <option value="èŒ¶å±‹ç”º">èŒ¶å±‹ç”º</option>
        <option value="å¤§å®‰å¯º">å¤§å®‰å¯º</option>
        <option value="ä¸­åº„">ä¸­åº„</option>
        <option value="ç·ç¤¾å—">ç·ç¤¾å—</option>
        <option value="å††å±±">å††å±±</option>
        <option value="å…å³¶">å…å³¶</option>
      </select>
      <input type="number" name="quantity" min="1" placeholder="å€‹æ•°" required>
    </div>
  </div>

  <button type="button" onclick="addStore()">+ åº—èˆ—è¿½åŠ </button>
  <button type="submit">ç™»éŒ²</button>
</form>

<script>
const today = new Date();
const yyyy = today.getFullYear();
const mm = String(today.getMonth()+1).padStart(2,'0');
const dd = String(today.getDate()).padStart(2,'0');
document.getElementById('dateInput').value = `${yyyy}-${mm}-${dd}`;

let selectedItem = null;
const itemButtons = document.querySelectorAll('.item-button');
itemButtons.forEach(btn=>{
  btn.addEventListener('click', function(){
    itemButtons.forEach(b=>b.classList.remove('selected'));
    this.classList.add('selected');
    selectedItem = this.getAttribute('data-value');
  });
});

function addStore(){
  const container = document.getElementById('storesContainer');
  const div = document.createElement('div');
  div.className='store-row';
  div.innerHTML=`
    <select name="store">
      <option value="é€£å³¶">é€£å³¶</option>
      <option value="æ´¥é«˜">æ´¥é«˜</option>
      <option value="èŒ¶å±‹ç”º">èŒ¶å±‹ç”º</option>
      <option value="å¤§å®‰å¯º">å¤§å®‰å¯º</option>
      <option value="ä¸­åº„">ä¸­åº„</option>
      <option value="ç·ç¤¾å—">ç·ç¤¾å—</option>
      <option value="å††å±±">å††å±±</option>
      <option value="å…å³¶">å…å³¶</option>
    </select>
    <input type="number" name="quantity" min="1" placeholder="å€‹æ•°" required>
  `;
  container.appendChild(div);
}

// ğŸ”¹ ãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§OK
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxw3XhK2BHXcGXNQxFMe7BEH6tfTkqkXHWTP0cPUAgEFkTVO6A2vGPZPgkT8dHthAXnuw/exec";

document.getElementById('shipmentForm').addEventListener('submit', async function(e){
  e.preventDefault();
  if(!selectedItem){
    alert('å“ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„');
    return;
  }

  const form = e.target;
  const data = {
    date: form.date.value,
    item: selectedItem,
    price: form.price.value,
    stores: Array.from(form.querySelectorAll('.store-row')).map(row=>({
      name: row.querySelector('select[name="store"]').value,
      quantity: row.querySelector('input[name="quantity"]').value
    }))
  };

  try{
    // mode:no-cors ã§ CORS ã‚¨ãƒ©ãƒ¼å›é¿
    await fetch(SCRIPT_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data),
      mode:'no-cors'
    });
    alert('ç™»éŒ²å®Œäº†ï¼');
    form.reset();
    selectedItem = null;
  }catch(err){
    alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼: '+err);
  }
});
</script>

</body>
</html>
